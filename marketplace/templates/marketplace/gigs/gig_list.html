{% extends 'marketplace/base.html' %}

{% block title %}Browse Gigs - FreelanceHub{% endblock %}

{% block content %}

<div class="page-header">
    <div class="container">
        <p
            style="font-size:0.85rem;text-transform:uppercase;letter-spacing:0.15em;color:rgba(255,255,255,0.4);font-weight:600;margin-bottom:0.5rem;">
            Services</p>
        <h1 style="font-size:2.8rem;font-weight:900;letter-spacing:-1.5px;">Browse Gigs</h1>
        <p style="color:rgba(255,255,255,0.5);font-size:1.05rem;margin:0;">Find the perfect service for your needs</p>
    </div>
</div>

<div class="container" style="padding-bottom:4rem;">

    <div class="glass-panel p-4 mb-4">
        <form method="get" class="row g-3 align-items-end">
            <div class="col-md-4">
                <label class="form-label">Search</label>
                <div style="position:relative;">
                    <i class="bi bi-search"
                        style="position:absolute;left:12px;top:50%;transform:translateY(-50%);color:rgba(255,255,255,0.3);"></i>
                    <input type="text" name="search" class="form-control" placeholder="Search gigs..."
                        value="{{ request.GET.search }}" style="padding-left:2.5rem;">
                </div>
            </div>
            <div class="col-md-3">
                <label class="form-label">Category</label>
                <select name="category" class="form-select">
                    <option value="">All Categories</option>
                    {% for cat in categories %}
                    <option value="{{ cat.id }}">{{ cat.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">Min Price</label>
                <input type="number" name="min_price" class="form-control" placeholder="₹0"
                    value="{{ request.GET.min_price }}">
            </div>
            <div class="col-md-2">
                <label class="form-label">Max Price</label>
                <input type="number" name="max_price" class="form-control" placeholder="₹99999"
                    value="{{ request.GET.max_price }}">
            </div>
            <div class="col-md-1">
                <button type="submit" class="btn btn-primary w-100">
                    <i class="bi bi-search"></i>
                </button>
            </div>
        </form>
    </div>

    {% if user.is_authenticated %}
    {% if user.freelancer_profile %}
    <div class="mb-4">
        <a href="{% url 'gig_create' %}" class="btn btn-primary">
            <i class="bi bi-plus-circle me-2"></i>Create New Gig
        </a>
    </div>
    {% endif %}
    {% endif %}

    {% if gigs %}
    <div class="row g-4">
        {% for gig in gigs %}
        <div class="col-lg-3 col-md-4 col-sm-6">
            <div class="card h-100">
                {% if gig.image %}
                <img src="{{ gig.image.url }}" alt="{{ gig.title }}"
                    style="height:190px;object-fit:cover;border-radius:16px 16px 0 0;filter:grayscale(15%);">
                {% else %}
                <div
                    style="height:190px;background:linear-gradient(135deg,rgba(255,255,255,0.06) 0%,rgba(255,255,255,0.02) 100%);border-radius:16px 16px 0 0;display:flex;align-items:center;justify-content:center;border-bottom:1px solid rgba(255,255,255,0.08);">
                    <i class="bi bi-image" style="font-size:2.5rem;color:rgba(255,255,255,0.12);"></i>
                </div>
                {% endif %}
                <div class="card-body d-flex flex-column">
                    {% if gig.category %}
                    <span class="badge bg-secondary mb-2" style="width:fit-content;">{{ gig.category.name }}</span>
                    {% endif %}
                    <h6 style="font-weight:700;margin-bottom:0.5rem;line-height:1.4;min-height:42px;">{{
                        gig.title|truncatewords:7 }}</h6>
                    <p style="font-size:0.85rem;color:rgba(255,255,255,0.4);flex-grow:1;margin-bottom:1rem;">{{
                        gig.description|truncatewords:12 }}</p>
                    <div class="d-flex justify-content-between align-items-end mb-3">
                        <span style="font-size:1.3rem;font-weight:800;">₹{{ gig.price }}</span>
                        <div class="text-end">
                            <div style="font-size:0.8rem;color:rgba(255,255,255,0.6);" title="Delivery Time">
                                <i class="bi bi-hourglass-split me-1"></i>{{ gig.delivery_time }} Days
                            </div>
                            <small style="font-size:0.7rem;color:rgba(255,255,255,0.35);">
                                Posted {{ gig.created_at|timesince }} ago
                            </small>
                        </div>
                    </div>
                    <a href="{% url 'gig_detail' gig.pk %}" class="btn btn-outline-primary w-100">
                        View Details <i class="bi bi-arrow-right ms-1"></i>
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    {% if is_paginated %}
    <nav class="mt-5">
        <ul class="pagination justify-content-center gap-1">
            {% if page_obj.has_previous %}
            <li class="page-item"><a class="page-link" href="?page=1"><i class="bi bi-chevron-double-left"></i></a></li>
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}"><i
                        class="bi bi-chevron-left"></i></a></li>
            {% endif %}
            <li class="page-item active"><span class="page-link">{{ page_obj.number }} / {{ page_obj.paginator.num_pages
                    }}</span></li>
            {% if page_obj.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}"><i
                        class="bi bi-chevron-right"></i></a></li>
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.paginator.num_pages }}"><i
                        class="bi bi-chevron-double-right"></i></a></li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}

    {% else %}
    <div class="text-center py-5">
        <div
            style="width:80px;height:80px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:20px;display:flex;align-items:center;justify-content:center;margin:0 auto 1.5rem;">
            <i class="bi bi-inbox" style="font-size:2rem;color:rgba(255,255,255,0.3);"></i>
        </div>
        <h4 style="font-weight:700;margin-bottom:0.5rem;">No gigs found</h4>
        <p style="color:rgba(255,255,255,0.4);">Try adjusting your search criteria</p>
    </div>
    {% endif %}
</div>
{% endblock %}