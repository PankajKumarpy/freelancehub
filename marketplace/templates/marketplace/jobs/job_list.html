{% extends 'marketplace/base.html' %}

{% block title %}Browse Jobs - FreelanceHub{% endblock %}

{% block content %}

<div class="page-header">
    <div class="container">
        <p
            style="font-size:0.85rem;text-transform:uppercase;letter-spacing:0.15em;color:rgba(255,255,255,0.4);font-weight:600;margin-bottom:0.5rem;">
            Opportunities</p>
        <h1 style="font-size:2.8rem;font-weight:900;letter-spacing:-1.5px;">Find Jobs</h1>
        <p style="color:rgba(255,255,255,0.5);font-size:1.05rem;margin:0;">Discover opportunities that match your skills
        </p>
    </div>
</div>

<div class="container" style="padding-bottom:4rem;">

    <div class="glass-panel p-4 mb-4">
        <form method="get" class="row g-3 align-items-end">
            <div class="col-md-5">
                <label class="form-label">Search</label>
                <div style="position:relative;">
                    <i class="bi bi-search"
                        style="position:absolute;left:12px;top:50%;transform:translateY(-50%);color:rgba(255,255,255,0.3);"></i>
                    <input type="text" name="search" class="form-control" placeholder="Search jobs..."
                        value="{{ request.GET.search }}" style="padding-left:2.5rem;">
                </div>
            </div>
            <div class="col-md-3">
                <label class="form-label">Category</label>
                <select name="category" class="form-select">
                    <option value="">All Categories</option>
                    {% for cat in categories %}
                    <option value="{{ cat.id }}">{{ cat.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Status</label>
                <select name="status" class="form-select">
                    <option value="">All Status</option>
                    <option value="Open" {% if request.GET.status=="Open" %}selected{% endif %}>Open</option>
                    <option value="In Progress" {% if request.GET.status=="In Progress" %}selected{% endif %}>In
                        Progress</option>
                    <option value="Completed" {% if request.GET.status=="Completed" %}selected{% endif %}>Completed
                    </option>
                </select>
            </div>
            <div class="col-md-1">
                <button type="submit" class="btn btn-primary w-100">
                    <i class="bi bi-search"></i>
                </button>
            </div>
        </form>
    </div>

    {% if user.is_authenticated %}
    {% if user.client_profile %}
    <div class="mb-4">
        <a href="{% url 'job_create' %}" class="btn btn-primary">
            <i class="bi bi-plus-circle me-2"></i>Post New Job
        </a>
    </div>
    {% endif %}
    {% endif %}

    {% if jobs %}
    <div class="d-flex flex-column gap-3">
        {% for job in jobs %}
        <div class="card">
            <div class="card-body p-4">
                <div class="row align-items-center g-3">
                    <div class="col-md-8">
                        <div class="d-flex flex-wrap gap-2 mb-2">
                            {% if job.category %}
                            <span class="badge bg-secondary">{{ job.category.name }}</span>
                            {% endif %}
                            {% if job.status == "Open" %}
                            <span class="badge bg-success">{{ job.status }}</span>
                            {% elif job.status == "In Progress" %}
                            <span class="badge bg-warning">{{ job.status }}</span>
                            {% else %}
                            <span class="badge bg-info">{{ job.status }}</span>
                            {% endif %}
                        </div>
                        <h5 style="font-weight:700;margin-bottom:0.5rem;">{{ job.title }}</h5>
                        <p style="color:rgba(255,255,255,0.45);font-size:0.9rem;margin-bottom:1rem;line-height:1.6;">{{
                            job.description|truncatewords:30 }}</p>
                        <div class="d-flex flex-wrap gap-4" style="font-size:0.82rem;color:rgba(255,255,255,0.35);">
                            <span><i class="bi bi-clock-history me-1"></i>Posted {{ job.created_at|timesince }}
                                ago</span>
                            <span><i class="bi bi-calendar me-1"></i>Deadline: {{ job.deadline }}</span>
                            <span><i class="bi bi-chat-left-text me-1"></i>{{ job.bids.count }} bid{{
                                job.bids.count|pluralize }}</span>
                            <span><i class="bi bi-person me-1"></i>{{ job.client.username }}</span>
                        </div>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <div style="font-size:2rem;font-weight:900;margin-bottom:0.75rem;">₹{{ job.budget }}</div>
                        <a href="{% url 'job_detail' job.pk %}" class="btn btn-primary">
                            View Details <i class="bi bi-arrow-right ms-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    {% if is_paginated %}
    <nav class="mt-5">
        <ul class="pagination justify-content-center gap-1">
            {% if page_obj.has_previous %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}"><i
                        class="bi bi-chevron-left"></i></a></li>
            {% endif %}
            <li class="page-item active"><span class="page-link">{{ page_obj.number }} / {{ page_obj.paginator.num_pages
                    }}</span></li>
            {% if page_obj.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}"><i
                        class="bi bi-chevron-right"></i></a></li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}

    {% else %}
    <div class="text-center py-5">
        <div
            style="width:80px;height:80px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:20px;display:flex;align-items:center;justify-content:center;margin:0 auto 1.5rem;">
            <i class="bi bi-briefcase" style="font-size:2rem;color:rgba(255,255,255,0.3);"></i>
        </div>
        <h4 style="font-weight:700;margin-bottom:0.5rem;">No jobs found</h4>
        <p style="color:rgba(255,255,255,0.4);">Try adjusting your search criteria</p>
    </div>
    {% endif %}
</div>
{% endblock %}